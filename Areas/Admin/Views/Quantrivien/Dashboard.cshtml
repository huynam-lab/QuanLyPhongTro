@model IEnumerable<QuanLyPhongTro.Models.Phong_Tro>
@{
    ViewBag.Title = "Dashboard";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
}

<div class="row g-3 mb-4">
    <div class="col-md-3">
        <div class="card shadow-sm border-0">
            <div class="card-body">
                <p class="text-muted mb-1">Tài khoản</p>
                <h3>@ViewBag.TotalUser</h3>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card shadow-sm border-0">
            <div class="card-body">
                <p class="text-muted mb-1">Hiển thị</p>
                <h3>@ViewBag.PhongHienThi</h3>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card shadow-sm border-0">
            <div class="card-body">
                <p class="text-muted mb-1">Hết hạn</p>
                <h3>@ViewBag.HetHan</h3>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card shadow-sm border-0">
            <div class="card-body">
                <p class="text-muted mb-1">Chờ duyệt</p>
                <h3>@ViewBag.PhongChoDuyet</h3>
            </div>
        </div>
    </div>
</div>
<!-- ==================== BIỂU ĐỒ DASHBOARD ==================== -->
<div class="row g-3 mb-4">
    <!-- Biểu đồ Bài đăng -->
    <div class="col-md-6">
        <div class="card shadow-sm border-0">
            <div class="card-header bg-white">
                <h6 class="mb-0">📊 Biểu đồ bài đăng theo tháng</h6>
            </div>
            <div class="card-body" style="height: 300px;">
                <canvas id="chartPosts"></canvas>
            </div>
        </div>
    </div>

    <!-- Biểu đồ Tài khoản -->
    <div class="col-md-6">
        <div class="card shadow-sm border-0">
            <div class="card-header bg-white">
                <h6 class="mb-0">👥 Biểu đồ tài khoản theo tháng</h6>
            </div>
            <div class="card-body" style="height: 300px;">
                <canvas id="chartUsers"></canvas>
            </div>
        </div>
    </div>
</div>

<div class="card shadow-sm border-0">
    <div class="card-header bg-white">
        <h6 class="mb-0">Tin mới nhất</h6>
    </div>
    <div class="card-body p-0">
        <!-- khung cuộn riêng cho bảng -->
        <div class="table-responsive" style="max-height: 445px; overflow-y:auto;">
            <table class="table align-middle mb-0" style="position: relative;">
                <thead class="table-light" style="position: sticky; top: 0; z-index: 2;">
                    <tr>
                        <th style="width:70px;">Mã</th>
                        <th>Tiêu đề</th>
                        <th style="width:130px;">Ngày đăng</th>
                        <th style="width:120px;">Trạng thái</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var p in Model)
                        {
                        <tr>
                            <td>#@p.ID_Phong_Tro</td>
                            <td>@p.Ten_Phong</td>
                            <td>@(p.Ngay_Dang?.ToString("dd/MM/yyyy"))</td>
                            <td>
                                @if (p.Trang_Thai == true)
                                    {
                                    <span class="badge bg-success">Hiển thị</span>
                                    }
                                else
                                    {
                                    <span class="badge bg-warning text-dark">Chờ duyệt</span>
                                    }
                            </td>
                        </tr>
                        }

                    @if (!Model.Any())
                        {
                        <tr>
                            <td colspan="4" class="text-center py-4 text-muted">Không có dữ liệu</td>
                        </tr>
                        }
                </tbody>
            </table>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function () {

    /* ======================================================
       🟦 BIỂU ĐỒ 1: BÀI ĐĂNG THEO THÁNG (Bar Chart)
    ====================================================== */
    const ctxPosts = document.getElementById('chartPosts').getContext('2d');
    const gradientPosts = ctxPosts.createLinearGradient(0, 0, 0, 300);
    gradientPosts.addColorStop(0, 'rgba(54, 162, 235, 0.8)');
    gradientPosts.addColorStop(1, 'rgba(54, 162, 235, 0.15)');

    new Chart(ctxPosts, {
        type: 'bar',
        data: {
            labels: @Html.Raw(Json.Encode(ViewBag.PostsLabels)),
            datasets: [{
                label: 'Số lượng bài đăng',
                data: @Html.Raw(Json.Encode(ViewBag.PostsCounts)),
                backgroundColor: gradientPosts,
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 2,
                borderRadius: 8,
                hoverBackgroundColor: 'rgba(54, 162, 235, 0.9)',
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                title: {
                    display: true,
                    text: '📊 Biểu đồ bài đăng theo tháng',
                    color: '#333',
                    font: { size: 15, weight: 'bold' }
                },
                tooltip: {
                    backgroundColor: 'rgba(255,255,255,0.9)',
                    titleColor: '#000',
                    bodyColor: '#000',
                    borderColor: '#ccc',
                    borderWidth: 1,
                    displayColors: false,
                    callbacks: {
                        label: ctx => ` ${ctx.parsed.y} bài đăng`
                    }
                }
            },
            scales: {
                x: {
                    grid: { display: false },
                    ticks: { color: '#555', font: { size: 12 } }
                },
                y: {
                    beginAtZero: true,
                    grid: { color: '#eee' },
                    ticks: { color: '#555', font: { size: 12 } }
                }
            },
            animation: {
                duration: 1500,
                easing: 'easeOutQuart'
            }
        }
    });


    /* ======================================================
       🟩 BIỂU ĐỒ 2: TÀI KHOẢN THEO THÁNG (Line Chart)
    ====================================================== */
    const ctxUsers = document.getElementById('chartUsers').getContext('2d');
    const gradientUsers = ctxUsers.createLinearGradient(0, 0, 0, 300);
    gradientUsers.addColorStop(0, 'rgba(0, 230, 118, 0.6)');
    gradientUsers.addColorStop(1, 'rgba(0, 230, 118, 0.05)');

    new Chart(ctxUsers, {
        type: 'line',
        data: {
            labels: @Html.Raw(Json.Encode(ViewBag.UsersLabels)),
            datasets: [{
                label: 'Số lượng tài khoản mới',
                data: @Html.Raw(Json.Encode(ViewBag.UsersCounts)),
                fill: true,
                backgroundColor: gradientUsers,
                borderColor: 'rgba(0, 200, 83, 1)',
                borderWidth: 3,
                pointRadius: 6,
                pointBackgroundColor: '#fff',
                pointBorderColor: 'rgba(0, 200, 83, 1)',
                pointHoverBackgroundColor: 'rgba(0, 200, 83, 1)',
                pointHoverBorderColor: '#fff',
                pointHoverRadius: 8,
                tension: 0.35
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                },
                title: {
                    display: true,
                    text: '👥 Biểu đồ tài khoản theo tháng',
                    color: '#333',
                    font: { size: 15, weight: 'bold' }
                },
                tooltip: {
                    backgroundColor: 'rgba(255,255,255,0.9)',
                    titleColor: '#000',
                    bodyColor: '#000',
                    borderColor: 'rgba(0,0,0,0.1)',
                    borderWidth: 1,
                    displayColors: false,
                    callbacks: {
                        label: ctx => ` ${ctx.parsed.y} tài khoản`
                    }
                }
            },
            scales: {
                x: {
                    grid: { color: 'rgba(0,0,0,0.05)' },
                    ticks: { color: '#444', font: { size: 12, weight: '500' } }
                },
                y: {
                    beginAtZero: true,
                    grid: { color: 'rgba(0,0,0,0.05)' },
                    ticks: { color: '#444', font: { size: 12, weight: '500' } }
                }
            },
            interaction: {
                mode: 'index',
                intersect: false
            },
            animation: {
                duration: 1800,
                easing: 'easeInOutQuart'
            }
        }
    });
});
</script>
