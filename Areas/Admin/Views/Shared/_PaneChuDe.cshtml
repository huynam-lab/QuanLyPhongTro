@model IEnumerable<QuanLyPhongTro.Models.Chu_De>

<div class="d-flex justify-content-between align-items-center mb-2">
    <h6 class="mb-0">Chủ đề</h6>
    <button class="btn btn-sm btn-primary" data-edit="{}" data-target="#mdChuDe">
        <i class="bi bi-plus"></i> Thêm
    </button>
</div>

<div class="table-responsive" style="max-height:70vh; overflow-y:auto;">
    <table class="table table-hover align-middle mb-0">
        <thead class="table-light">
            <tr>
                <th style="width:80px;">ID</th>
                <th>Tên chủ đề</th>
                <th style="width:120px;"></th>
            </tr>
        </thead>
        <tbody>
            @foreach (var cd in Model)
                {
                var data = new { ID_CD = cd.ID_CD, Ten_CD = cd.Ten_CD };
                <tr>
                    <td>@cd.ID_CD</td>
                    <td>@cd.Ten_CD</td>
                    <td class="text-end">
                        <button class="btn btn-sm btn-outline-primary"
                                data-edit='@Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(data))'
                                data-target="#mdChuDe">
                            <i class="bi bi-pencil"></i>
                        </button>
                        @using (Html.BeginForm("DeleteChuDe", "Quantrivien", FormMethod.Post,
                            new { area = "Admin", onsubmit = "return confirm('Xóa chủ đề này?');" }))
                            {
                            @Html.AntiForgeryToken()
                            <input type="hidden" name="id" value="@cd.ID_CD" />
                            <button class="btn btn-sm btn-outline-danger ms-1">
                                <i class="bi bi-trash"></i>
                            </button>
                            }
                    </td>
                </tr>
                }
            @if (!Model.Any())
                {
                <tr><td colspan="3" class="text-center text-muted py-4">Chưa có chủ đề</td></tr>
                }
        </tbody>
    </table>
</div>

<!-- Modal thêm/sửa -->
<div class="modal fade" id="mdChuDe" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            @using (Html.BeginForm("SaveChuDe", "Quantrivien", FormMethod.Post, new { area = "Admin" }))
                {
                @Html.AntiForgeryToken()
                <div class="modal-header">
                    <h6 class="modal-title">Chủ đề</h6>
                    <button class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="ID_CD" />
                    <div class="mb-2">
                        <label class="form-label">Tên chủ đề</label>
                        <input name="Ten_CD" class="form-control" required />
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary">Lưu</button>
                </div>
                }
        </div>
    </div>
</div>
@{
    var success = TempData["Success"] ?? TempData["SuccessMessage"];
    var error = TempData["Error"];
    var warning = TempData["Warning"];
    var info = TempData["Info"];
}

@if (success != null)
    {
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            Swal.fire({
                title: "Thành công 🎉",
                text: "@Html.Raw(success)",
                icon: "success",
                confirmButtonText: "OK",
                timer: 3000,
                timerProgressBar: true
            });
        });
    </script>
    }
else if (error != null)
    {
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            Swal.fire({
                title: "Lỗi ❌",
                text: "@Html.Raw(error)",
                icon: "error",
                confirmButtonText: "Đóng"
            });
        });
    </script>
    }
else if (warning != null)
    {
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            Swal.fire({
                title: "Cảnh báo ⚠️",
                text: "@Html.Raw(warning)",
                icon: "warning",
                confirmButtonText: "OK"
            });
        });
    </script>
    }
else if (info != null)
    {
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            Swal.fire({
                title: "Thông báo 💬",
                text: "@Html.Raw(info)",
                icon: "info",
                confirmButtonText: "OK"
            });
        });
    </script>
    }

@section scripts {
    <script>
        document.addEventListener('click', function (e) {
            const btn = e.target.closest('[data-target="#mdChuDe"]');
            if (!btn) return;
            const json = btn.dataset.edit ? JSON.parse(btn.dataset.edit) : {};
            const modal = document.querySelector('#mdChuDe');
            modal.querySelector('[name="ID_CD"]').value = json.ID_CD || '';
            modal.querySelector('[name="Ten_CD"]').value = json.Ten_CD || '';
            new bootstrap.Modal(modal).show();
        });
    </script>
}
