@model IEnumerable<QuanLyPhongTro.Models.ViewModels.PhongTroVM>
@{
    var page = (int)(ViewBag.Page ?? 1);
    var pageSize = (int)(ViewBag.PageSize ?? 10);
    var total = (int)(ViewBag.Total ?? 0);
    var totalPages = (int)Math.Ceiling(total / (double)pageSize);

    string FormatGia(decimal? vnd)
    {
        if (!vnd.HasValue || vnd <= 0) return "Thoả thuận";
        var trieu = vnd.Value / 1_000_000M;
        if (trieu >= 1) return trieu.ToString("0.#") + " triệu/tháng";
        return string.Format("{0:#,0} đ/tháng", vnd);
    }

    Func<string, string> Img = (u) => string.IsNullOrWhiteSpace(u)
        ? Url.Content("~/Assets/Images/no-image.png")
        : Url.Content(u.StartsWith("http") ? u : u);
}

@foreach (var p in Model)
{
    <article class="post-card shadow-sm position-relative">
        <div class="row g-0">
            <div class="col-md-5">
                <a href="@Url.Action("ChiTiet","User", new { id = p.Id })">
                    <img class="post-thumb"
                         src="@Img(p.AnhDaiDien)"
                         alt="@p.Ten"
                         onerror="this.onerror=null;this.src='@Url.Content("~/Assets/Images/no-image.png")';" />
                </a>
            </div>
            <div class="col-md-7 p-3">
                <a class="text-decoration-none" href="@Url.Action("ChiTiet","User", new { id = p.Id })">
                    <div class="post-title mb-2">@p.Ten</div>
                </a>

                <div class="d-flex align-items-center post-meta mb-2">
                    <div class="post-price me-3">@FormatGia(p.Gia)</div>
                    <div class="text-muted"><i class="bi bi-aspect-ratio me-1"></i> @(p.DienTich?.ToString("0.#") ?? "--") m²</div>
                    <div class="meta-dot"></div>
                    <div class="text-muted"><i class="bi bi-geo-alt me-1"></i> @p.KhuVuc</div>
                </div>

                <div class="text-muted small mb-2">@p.DiaChi</div>

                <div class="d-flex align-items-center justify-content-between">
                    <div class="text-muted small">
                        <i class="bi bi-clock me-1"></i>@(p.NgayDang?.ToString("dd/MM/yyyy") ?? "")
                    </div>
                    <a class="btn btn-success btn-sm" href="@Url.Action("ChiTiet","User", new { id = p.Id })">Liên hệ / Xem chi tiết</a>
                </div>
            </div>
        </div>
    </article>
}

@if (totalPages > 1)
{
    <nav class="mt-3">
        <ul class="pagination">
            <li class="page-item @(page==1?"disabled":"")">
                <a class="page-link" href="@Url.Action(null, new { page = page - 1, pageSize })">« Trang trước</a>
            </li>
            @for (int i = Math.Max(1, page - 2); i <= Math.Min(totalPages, page + 2); i++)
            {
                <li class="page-item @(i==page?"active":"")">
                    <a class="page-link" href="@Url.Action(null, new { page = i, pageSize })">@i</a>
                </li>
            }
            <li class="page-item @(page==totalPages?"disabled":"")">
                <a class="page-link" href="@Url.Action(null, new { page = page + 1, pageSize })">Trang sau »</a>
            </li>
        </ul>
    </nav>
}
